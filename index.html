<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Tamagotchi Cat</title>
<style>
  html, body {
    height: 100%; margin: 0;
    display: flex; align-items: center; justify-content: center;
    background: #e8f0f7;
    overflow: hidden;
  }
  canvas {
    display: block;
    touch-action: none;
  }
  .ui-hint {
    position: fixed;
    left: 12px;
    bottom: 12px;
    font-family: system-ui, -apple-system, Segoe UI, Roboto;
    color: #555;
    font-size: 14px;
  }
</style>
</head>
<body>
<canvas id="c"></canvas>
<div class="ui-hint">ðŸ‘† Interact with the cat: Watch it roam, double-tap for special actions, or swipe to see it lick the screen!</div>

<script>
(() => {
  const canvas = document.getElementById('c');
  const ctx = canvas.getContext('2d', { alpha: true });

  // Responsive canvas
  function resize() {
    const DPR = Math.min(window.devicePixelRatio || 1, 2); // Limit for performance
    const width = window.innerWidth;
    const height = window.innerHeight;
    canvas.width = width * DPR;
    canvas.height = height * DPR;
    canvas.style.width = `${width}px`;
    canvas.style.height = `${height}px`;
    ctx.setTransform(DPR, 0, 0, DPR, 0, 0);
  }
  window.addEventListener('resize', resize);
  resize();

  // State variables
  const state = {
    cat: {
      x: canvas.width / 2,
      y: canvas.height / 2,
      scale: 1,
      isWalking: false,
      isSitting: false,
      isLicking: false,
      direction: 1, // 1 for right, -1 for left
    },
    room: {
      width: canvas.width,
      height: canvas.height,
      furniture: {
        couch: { x: canvas.width / 3, y: canvas.height / 2, width: 200, height: 100 },
        mat: { x: canvas.width / 2, y: (canvas.height * 2) / 3, radius: 50 },
      },
    },
  };

  // Event handlers for interactions
  canvas.addEventListener('mousedown', () => {
    state.cat.isWalking = !state.cat.isWalking; // Toggle walking on tap
  });

  canvas.addEventListener('touchstart', (e) => {
    if (e.touches.length === 2) {
      // Double-tap for licking action
      state.cat.isLicking = true;
      setTimeout(() => (state.cat.isLicking = false), 1000);
    } else {
      state.cat.isWalking = !state.cat.isWalking; // Toggle walking on single tap
    }
  });

  // Helper functions
  function drawRoom() {
    // Draw background
    ctx.fillStyle = '#f5f7fa';
    ctx.fillRect(0, 0, state.room.width, state.room.height);

    // Draw couch
    const couch = state.room.furniture.couch;
    ctx.fillStyle = '#d3a8a8';
    ctx.fillRect(couch.x, couch.y, couch.width, couch.height);
    ctx.fillStyle = '#c19797';
    ctx.fillRect(couch.x, couch.y - 20, couch.width, 20); // Backrest

    // Draw mat
    const mat = state.room.furniture.mat;
    ctx.fillStyle = '#c4e7c5';
    ctx.beginPath();
    ctx.arc(mat.x, mat.y, mat.radius, 0, Math.PI * 2);
    ctx.fill();
  }

  function drawCat() {
    const { x, y, scale, direction, isWalking, isSitting, isLicking } = state.cat;

    ctx.save();
    ctx.translate(x, y);
    ctx.scale(direction * scale, scale);

    // Body
    ctx.fillStyle = '#f2c5aa';
    ctx.beginPath();
    ctx.ellipse(0, 20, 30, 20, 0, 0, Math.PI * 2);
    ctx.fill();

    // Head
    ctx.fillStyle = '#f2c5aa';
    ctx.beginPath();
    ctx.arc(0, -10, 25, 0, Math.PI * 2);
    ctx.fill();

    // Eyes
    ctx.fillStyle = '#fff';
    ctx.beginPath();
    ctx.arc(-10, -20, 8, 0, Math.PI * 2);
    ctx.arc(10, -20, 8, 0, Math.PI * 2);
    ctx.fill();
    ctx.fillStyle = '#333';
    ctx.beginPath();
    ctx.arc(-10, -20, 4, 0, Math.PI * 2);
    ctx.arc(10, -20, 4, 0, Math.PI * 2);
    ctx.fill();

    // Ears
    ctx.fillStyle = '#f2c5aa';
    ctx.beginPath();
    ctx.moveTo(-20, -30);
    ctx.lineTo(-10, -50);
    ctx.lineTo(0, -30);
    ctx.closePath();
    ctx.fill();
    ctx.beginPath();
    ctx.moveTo(20, -30);
    ctx.lineTo(10, -50);
    ctx.lineTo(0, -30);
    ctx.closePath();
    ctx.fill();

    // Tail
    ctx.fillStyle = '#f2c5aa';
    ctx.beginPath();
    ctx.ellipse(40, 20, 10, 30, 0, 0, Math.PI * 2);
    ctx.fill();

    // Mouth (dynamic for licking)
    ctx.fillStyle = '#e08080';
    if (isLicking) {
      ctx.beginPath();
      ctx.arc(0, -5, 10, 0, Math.PI, true);
      ctx.fill();
    } else {
      ctx.beginPath();
      ctx.arc(0, -5, 5, 0, Math.PI, true);
      ctx.fill();
    }

    // Legs (dynamic for walking/sitting)
    if (isWalking) {
      const legOffset = Math.sin(state.cat.walkCycle) * 5;
      ctx.fillStyle = '#f2c5aa';
      ctx.fillRect(-20, 30 + legOffset, 10, 20);
      ctx.fillRect(10, 30 - legOffset, 10, 20);
    } else if (isSitting) {
      ctx.fillStyle = '#f2c5aa';
      ctx.fillRect(-20, 30, 10, 15);
      ctx.fillRect(10, 30, 10, 15);
    } else {
      ctx.fillStyle = '#f2c5aa';
      ctx.fillRect(-20, 30, 10, 20);
      ctx.fillRect(10, 30, 10, 20);
    }

    ctx.restore();
  }

  // Update logic
  function update(dt) {
    const { cat, room } = state;

    if (cat.isWalking) {
      cat.x += cat.direction * 100 * dt;
      if (cat.x < 0 || cat.x > room.width) {
        cat.direction *= -1; // Bounce back on wall collision
      }
    }
  }

  // Animation loop
  let lastTime = performance.now();
  function frame(ts) {
    const dt = (ts - lastTime) / 1000;
    lastTime = ts;

    update(dt);

    ctx.clearRect(0, 0, canvas.width, canvas.height);
    drawRoom();
    drawCat();

    requestAnimationFrame(frame);
  }
  requestAnimationFrame(frame);
})();
</script>
</body>
</html>